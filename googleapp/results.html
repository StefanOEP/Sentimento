<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
		
		<style>
		body
		{
			background-color:white;
			text-color
		}
		
		</style>
		<title>Sentimento - By Jannik, Stefan and Lars</title>
		<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
		<script type="text/javascript" src="js/libs/underscore-min.js"></script>
		<script type="text/javascript" src="js/libs/moment.min.js"></script>
		<script type="text/javascript" src="https://www.google.com/jsapi"></script>
		<script type="text/javascript">
		  	var all = {"ekstrabladet.dk": {"all": 0.7045454545454546}, "nyhederne.tv2.dk": {"all": 0.6089743589743589}};
			var year = {"ekstrabladet.dk": {"2013": 0.7045454545454546}, "nyhederne.tv2.dk": {"2012": 0.9076923076923077, "2013": -0.8846153846153846}}
			var month = {"ekstrabladet.dk": {"2013-11": 0.7010309278350515, "2013-12": 2.1666666666666665, "2013-9": 0.4444444444444444, "2013-10": 0.4}, "nyhederne.tv2.dk": {"2012-7": 0.7735849056603774, "2012-8": 1.125, "2013-8": -1.9166666666666667, "2012-10": 0.38461538461538464, "2013-5": 0.5555555555555556, "2013-11": -1.0}}
			var day = {"ekstrabladet.dk": {"2013-11-8": 2.5714285714285716, "2013-9-7": 0.4444444444444444, "2013-10-19": 0.45454545454545453, "2013-11-7": -0.5833333333333334, "2013-11-5": 0.7777777777777778, "2013-11-13": 0.75, "2013-11-12": 1.0769230769230769, "2013-12-3": 2.1666666666666665, "2013-11-17": 1.0, "2013-11-16": 0.8571428571428571, "2013-11-15": 1.5714285714285714, "2013-11-14": 1.1666666666666667, "2013-11-22": 0.5, "2013-11-20": -0.5, "2013-11-21": 0.0, "2013-11-19": 0.5, "2012-8-13": 0.3333333333333333}, "nyhederne.tv2.dk": {"2012-8-2": 1.5833333333333333, "2013-11-9": -1.0, "2012-7-30": 1.6, "2012-7-26": 0.5, "2012-8-11": 1.375, "2012-8-4": 2.2222222222222223, "2012-7-24": 0.0, "2012-8-1": 0.045454545454545456, "2013-8-15": -1.9166666666666667, "2013-11-8": 0.5555555555555556, "2012-8-13": 2.0, "2012-7-27": 0.7142857142857143, "2012-10-21": 0.38461538461538464, "2012-7-31": 1.1666666666666667}};

			var res = [];
			$.each(day, function(i,obj){
				if(_.isEmpty(res)){
					res.push(_.pairs(obj));
					console.log(res);
				}else{
					$.each(obj, function(j, val){
						var matchingPair = _.find(res[0], function(pair){
							return pair[0] == j // first in pair is the date string
						});
						if(_.isUndefined(matchingPair)){
							res[0].push([j,val]);	
						}else{
							matchingPair.push(val);	
						}
					})
				}
			});
			console.log(res);

		  google.load("visualization", "1", {packages:["corechart"]});
		  google.setOnLoadCallback(getChartData);

		  function jsonToDataTable(json, granularity){
		  	$.each(json, function(i, v){

		  	});
		  		$.each(json, function(i, v){
		  			if(granularity == "day"){
		  				var dateObj = moment(i, "YYYY-MM-DD").toDate();

		  			}
		  		});
		  }
		  
		  function getChartData(){

		  	//Get query data
		  	//Topic=fdsf&TV2=on&EB=on

		  	send_data = {"Topic": GetURLParameter("Topic"),
		  				"Sources": GetURLParameter("Sources"),
		  				"Startdate": GetURLParameter("Startdate"),
		  				"Enddate": GetURLParameter("Enddate")

		  	};
		  	
			$.get("/api", send_data).done(function(data){
				var json = $.parseJSON(data);
				//drawChart(JSON.parse(data));


				// Test 
				var dataTable = [
			          ['Year', 'Sales', 'Expenses'],
			          [new Date (2004),  1000,      400],
			          [new Date (2005),  true,      460],
			          [new Date (2005),  660,       true],
			          [new Date (2007),  1030,      540],
			          [new Date (2010),  true,       1120]
			        ]
				drawChart(dataTable);
			});
		  }
		  
		  function drawChart(json_data) {
			var data = google.visualization.arrayToDataTable(json_data);

			var options = {
			  title: 'Sentiment analysis results',
			  width: {{ chart_width }},
			  height: '400'
			};

			var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
			chart.draw(data, options);
		  }
		  function GetURLParameter(sParam){

		    var sPageURL = window.location.search.substring(1);
		    var sURLVariables = sPageURL.split('&');
		    for (var i = 0; i < sURLVariables.length; i++) 
			    {
			        var sParameterName = sURLVariables[i].split('=');
			        if (sParameterName[0] == sParam) 
			        {
			            return sParameterName[1];
			        }
			    }
			}
		</script>
	</head>
	<body>
		<h1> Results </h1>
		<div id="chart_div"></div>
	</body>
</html>